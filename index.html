<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Navega칞칚o AR com GPS</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-gps-entity-place/dist/aframe-gps-entity-place.min.js"></script>
    
    <script src="https://unpkg.com/geolib@3.3.4/lib/geolib.js"></script> 
    
    <style>
      body, html {
        margin: 0;
        overflow: hidden;
        height: 100%;
      }

      .info {
        position: fixed;
        bottom: 10px;
        left: 0;
        right: 0;
        text-align: center;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        font-family: sans-serif;
        padding: 10px;
        z-index: 200; /* Aumentado z-index para garantir que fique por cima */
      }
      
      #distance-label {
        position: fixed;
        top: 0; /* Colocado no topo absoluto */
        left: 0;
        right: 0;
        text-align: center;
        /* Mudado para tarja branca completa (que era o que estava aparecendo) */
        background: rgba(255, 255, 255, 1); 
        color: #000;
        font-family: sans-serif;
        font-weight: bold;
        padding: 10px; /* Aumentado o padding para visibilidade */
        z-index: 300; /* Z-index MUITO ALTO para sobrepor tudo do AR.js */
        line-height: 1.2;
      }
    </style>
  </head>

  <body>
    <div id="distance-label">Aguardando Geolocaliza칞칚o e Inicializa칞칚o...</div>
    
    <div class="info">游늸 Aponte o celular e procure o modelo 3D no ambiente</div>

    <a-scene
      embedded
      xr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-camera gps-camera rotation-reader></a-camera>

      <a-entity
        id="target-model"
        gps-entity-place="latitude: -8.0476; longitude: -34.8770; minDistance: 5;"
        gltf-model="modelos/Cubo.glb"
        scale="3 3 3"
        rotation="0 180 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000"
      ></a-entity>
    </a-scene>

    <script>
      // Coordenadas do destino
      const DESTINATION_LAT = -8.0476;
      const DESTINATION_LON = -34.8770;
      const distanceLabel = document.getElementById('distance-label');
      const model = document.getElementById('target-model');

      /**
       * Fun칞칚o de sucesso para o monitoramento de GPS
       */
      function successCallback(pos) {
        // Verifica se o geolib est치 carregado
        if (typeof geolib === 'undefined') {
             distanceLabel.textContent = "ERRO: Biblioteca Geolib n칚o carregada. (Verifique o link JS)";
             return;
        }

        const userLat = pos.coords.latitude;
        const userLon = pos.coords.longitude;
        
        // 1. C치lculo da Dist칙ncia
        const distanceMeters = geolib.getDistance(
          { latitude: userLat, longitude: userLon },
          { latitude: DESTINATION_LAT, longitude: DESTINATION_LON }
        );

        // 2. Formata칞칚o e Exibi칞칚o da Dist칙ncia
        let distanceText;
        if (distanceMeters < 1000) {
          distanceText = `${distanceMeters.toFixed(1)} metros`;
        } else {
          distanceText = `${(distanceMeters / 1000).toFixed(2)} km`;
        }
        
        // O texto principal agora 칠 atualizado continuamente
        distanceLabel.innerHTML = `游꿢 Dist칙ncia: ${distanceText}`;
        
        // Se a dist칙ncia for muito grande, adicione um aviso de ajuste de escala
        if (distanceMeters > 500) {
            distanceLabel.innerHTML += `<br><small>(${distanceMeters}m de dist칙ncia. Modelo 3D pode n칚o ser vis칤vel.)</small>`;
        }
        
        // Console log para depura칞칚o
        console.log(`游늸 Lat: ${userLat}, Lon: ${userLon} | Dist칙ncia: ${distanceMeters.toFixed(2)}m`);
      }

      /**
       * Fun칞칚o de erro para o monitoramento de GPS
       */
      function errorCallback(err) {
        let errorMsg = "丘멆잺 ERRO GPS DESCONHECIDO";
        
        switch (err.code) {
          case err.PERMISSION_DENIED:
            errorMsg = "丘멆잺 PERMISS츾O NEGADA. Habilite a Localiza칞칚o para este site.";
            break;
          case err.POSITION_UNAVAILABLE:
            errorMsg = "丘멆잺 Localiza칞칚o Indispon칤vel. Sinal GPS fraco.";
            break;
          case err.TIMEOUT:
            errorMsg = "丘멆잺 Tempo esgotado. Recarregue a p치gina e tente em local aberto.";
            break;
        }
        // Garante que a mensagem de erro permane칞a na tarja
        distanceLabel.textContent = errorMsg;
        console.error("ERRO GPS:", err.message, "C칩digo:", err.code);
      }

      // Inicia o monitoramento da posi칞칚o do usu치rio
      navigator.geolocation.watchPosition(
        successCallback,
        errorCallback,
        { 
          enableHighAccuracy: true, 
          maximumAge: 0, 
          timeout: 15000 // Tempo limite aumentado
        }
      );
    </script>
  </body>
</html>